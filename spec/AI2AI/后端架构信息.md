# 后端架构信息

> 此文档由 AI 维护，记录后端目录结构和模块外部特性

## 目录结构

```
backend/
├── prisma/
│   ├── schema.prisma     # Prisma 数据模型定义
│   └── seed.ts           # 测试数据初始化脚本
├── src/
│   ├── config/
│   │   └── index.ts      # 配置文件（JWT密钥、数据库等）
│   ├── middlewares/
│   │   ├── auth.ts       # JWT 认证中间件
│   │   ├── error.ts      # 错误处理中间件
│   │   └── cors.ts       # CORS 中间件
│   ├── routes/
│   │   ├── auth.ts       # 认证路由
│   │   └── employees.ts  # 员工管理路由
│   ├── services/
│   │   ├── auth.ts       # 认证业务逻辑
│   │   └── employees.ts  # 员工管理业务逻辑
│   ├── types/
│   │   └── index.ts      # TypeScript 类型定义
│   ├── utils/
│   │   ├── jwt.ts        # JWT 工具函数
│   │   └── password.ts   # 密码哈希工具（bcrypt）
│   └── index.ts          # 应用入口
├── .env                  # 环境变量配置
├── .env.example          # 环境变量示例
├── package.json
└── tsconfig.json
```

## 模块说明

### src/index.ts
应用入口文件：
- 初始化 Express 应用
- 配置中间件（CORS、JSON解析、日志）
- 注册路由
- 启动服务器（默认端口 3001）
- 数据库连接初始化

### src/config/index.ts
配置管理：
- `JWT_SECRET` - JWT 签名密钥
- `JWT_EXPIRES_IN` - Token 过期时间（默认 7d）
- `DATABASE_URL` - SQLite 数据库路径

### src/middlewares/auth.ts
JWT 认证中间件：
- 从请求头获取 `Authorization: Bearer <token>`
- 验证 token 有效性
- 解析用户信息并挂载到 `req.user`
- 处理 token 过期和无效情况

### src/routes/auth.ts
认证路由：
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出
- `GET /api/auth/me` - 获取当前用户信息

### src/services/auth.ts
认证业务逻辑：
- `login(username, password)` - 验证用户名密码，生成 JWT
- `verifyToken(token)` - 验证 JWT 有效性
- `getUserById(id)` - 根据 ID 获取用户信息

### src/utils/jwt.ts
JWT 工具函数：
- `generateToken(payload)` - 生成 JWT token
- `verifyToken(token)` - 验证并解析 JWT

### src/utils/password.ts
密码工具函数：
- `hashPassword(password)` - 使用 bcrypt 哈希密码
- `comparePassword(password, hash)` - 比对密码和哈希值

### src/routes/employees.ts
员工管理路由：
- `GET /api/employees` - 获取员工列表（支持搜索和分页）
- `GET /api/employees/:id` - 获取单个员工详情
- `POST /api/employees` - 创建员工
- `PUT /api/employees/:id` - 更新员工信息
- `DELETE /api/employees/:id` - 删除员工
- `PATCH /api/employees/:id/status` - 更新员工状态

### src/services/employees.ts
员工管理业务逻辑：
- `getEmployees(filters, pagination)` - 获取员工列表（支持搜索、筛选、分页）
- `getEmployeeById(id)` - 根据 ID 获取员工详情
- `createEmployee(data)` - 创建新员工
- `updateEmployee(id, data)` - 更新员工信息
- `deleteEmployee(id)` - 删除员工
- `updateEmployeeStatus(id, status)` - 更新员工在职状态
