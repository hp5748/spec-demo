# 协议和数据

> 此文档由 AI 维护，记录前后端协议和数据库设计

## 前后端协议

### 基础配置
- Base URL: `http://localhost:3001/api`
- 认证方式: JWT Bearer Token (`Authorization: Bearer <token>`)
- 请求格式: `application/json`
- 响应格式: `application/json`

### 统一响应格式
```typescript
// 成功响应
{
  "success": true,
  "data": any,
  "message": string
}

// 错误响应
{
  "success": false,
  "error": string,
  "code": number
}
```

### 认证相关接口

#### POST /auth/login
用户登录

**请求体:**
```json
{
  "username": "admin",
  "password": "password123"
}
```

**响应:**
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "admin",
      "name": "系统管理员",
      "role": "admin"
    }
  }
}
```

#### POST /auth/logout
用户登出

**请求头:**
```
Authorization: Bearer <token>
```

**响应:**
```json
{
  "success": true,
  "message": "登出成功"
}
```

#### GET /auth/me
获取当前用户信息

**请求头:**
```
Authorization: Bearer <token>
```

**响应:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "username": "admin",
    "name": "系统管理员",
    "role": "admin"
  }
}
```

### 员工信息相关接口

#### GET /employees
获取员工列表（支持搜索和分页）

**请求头:**
```
Authorization: Bearer <token>
```

**查询参数:**
- `page` - 页码（默认1）
- `pageSize` - 每页数量（默认10）
- `name` - 姓名搜索（模糊匹配）
- `employeeNo` - 工号搜索（模糊匹配）
- `department` - 部门筛选
- `status` - 状态筛选（active/inactive）

**响应:**
```json
{
  "success": true,
  "data": {
    "list": [
      {
        "id": 1,
        "employeeNo": "EMP001",
        "name": "张三",
        "gender": "male",
        "age": 28,
        "phone": "13800138000",
        "email": "zhangsan@example.com",
        "department": "技术部",
        "position": "前端工程师",
        "level": "3B",
        "hireDate": "2023-01-15T00:00:00.000Z",
        "status": "active",
        "createdAt": "2024-01-01T00:00:00.000Z",
        "updatedAt": "2024-01-01T00:00:00.000Z"
      }
    ],
    "total": 100,
    "page": 1,
    "pageSize": 10
  }
}
```

#### GET /employees/:id
获取单个员工详情

**请求头:**
```
Authorization: Bearer <token>
```

**响应:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "employeeNo": "EMP001",
    "name": "张三",
    "gender": "male",
    "age": 28,
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "department": "技术部",
    "position": "前端工程师",
    "level": "3B",
    "hireDate": "2023-01-15T00:00:00.000Z",
    "status": "active",
    "createdAt": "2024-01-01T00:00:00.000Z",
    "updatedAt": "2024-01-01T00:00:00.000Z"
  }
}
```

#### POST /employees
创建员工

**请求头:**
```
Authorization: Bearer <token>
```

**请求体:**
```json
{
  "employeeNo": "EMP001",
  "name": "张三",
  "gender": "male",
  "age": 28,
  "phone": "13800138000",
  "email": "zhangsan@example.com",
  "department": "技术部",
  "position": "前端工程师",
  "level": "3B",
  "hireDate": "2023-01-15",
  "status": "active"
}
```

**响应:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "employeeNo": "EMP001",
    "name": "张三",
    "gender": "male",
    "age": 28,
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "department": "技术部",
    "position": "前端工程师",
    "level": "3B",
    "hireDate": "2023-01-15T00:00:00.000Z",
    "status": "active",
    "createdAt": "2024-01-01T00:00:00.000Z",
    "updatedAt": "2024-01-01T00:00:00.000Z"
  }
}
```

#### PUT /employees/:id
更新员工信息

**请求头:**
```
Authorization: Bearer <token>
```

**请求体:**
```json
{
  "name": "张三",
  "age": 29,
  "phone": "13800138001",
  "position": "高级前端工程师",
  "level": "4A"
}
```

**响应:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "employeeNo": "EMP001",
    "name": "张三",
    "gender": "male",
    "age": 29,
    "phone": "13800138001",
    "email": "zhangsan@example.com",
    "department": "技术部",
    "position": "高级前端工程师",
    "level": "4A",
    "hireDate": "2023-01-15T00:00:00.000Z",
    "status": "active",
    "createdAt": "2024-01-01T00:00:00.000Z",
    "updatedAt": "2024-02-10T00:00:00.000Z"
  }
}
```

#### DELETE /employees/:id
删除员工

**请求头:**
```
Authorization: Bearer <token>
```

**响应:**
```json
{
  "success": true,
  "message": "删除成功"
}
```

#### PATCH /employees/:id/status
更新员工状态

**请求头:**
```
Authorization: Bearer <token>
```

**请求体:**
```json
{
  "status": "inactive"
}
```

**响应:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "status": "inactive"
  }
}
```

#### GET /employees/export
导出员工数据为 Excel（仅管理员）

**请求头:**
```
Authorization: Bearer <token>
```

**查询参数:**
- `name` - 姓名筛选（可选）
- `employeeNo` - 工号筛选（可选）
- `department` - 部门筛选（可选）
- `status` - 状态筛选（可选）

**响应:**
- Content-Type: `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`
- 文件名: `员工信息_YYYY-MM-DD.xlsx`

Excel 包含字段：工号、姓名、性别、年龄、联系电话、邮箱、部门、岗位、职级、入职日期、状态

#### POST /employees/import
导入员工数据从 Excel（仅管理员）

**请求头:**
```
Authorization: Bearer <token>
Content-Type: multipart/form-data
```

**请求体:**
```
file: <Excel 文件 (.xlsx 或 .xls)>
```

**响应:**
```json
{
  "success": true,
  "data": {
    "success": 10,
    "failed": 2,
    "errors": [
      {
        "row": 5,
        "error": "工号、姓名和性别为必填项",
        "data": { "工号": "", "姓名": "测试", "性别": "男" }
      }
    ]
  },
  "message": "导入完成：成功 10 条，失败 2 条"
}
```

#### GET /employees/import/template
下载员工信息导入模板

**请求头:**
```
Authorization: Bearer <token>
```

**响应:**
- Content-Type: `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`
- 文件名: `员工信息导入模板.xlsx`

### 组织架构相关接口

#### GET /departments
获取部门列表

**请求头:**
```
Authorization: Bearer <token>
```

**响应:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "技术部",
      "description": "负责公司技术研发工作"
    }
  ]
}
```

#### POST /departments
创建部门（仅管理员）

**请求头:**
```
Authorization: Bearer <token>
```

**请求体:**
```json
{
  "name": "研发部",
  "description": "负责产品研发"
}
```

**响应:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "研发部",
    "description": "负责产品研发"
  }
}
```

#### PUT /departments/:id
更新部门（仅管理员）

**请求头:**
```
Authorization: Bearer <token>
```

**请求体:**
```json
{
  "name": "技术研发部",
  "description": "负责核心技术研发"
}
```

**响应:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "技术研发部",
    "description": "负责核心技术研发"
  }
}
```

#### DELETE /departments/:id
删除部门（仅管理员）

**响应:**
```json
{
  "success": true,
  "message": "删除成功"
}
```

#### GET /positions
获取岗位列表

**响应:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "前端工程师",
      "level": "3B"
    }
  ]
}
```

#### POST /positions
创建岗位（仅管理员）

**请求体:**
```json
{
  "name": "后端工程师",
  "level": "3A"
}
```

#### PUT /positions/:id
更新岗位（仅管理员）

#### DELETE /positions/:id
删除岗位（仅管理员）

#### GET /levels
获取职级列表

**响应:**
```json
{
  "success": true,
  "data": [
    { "id": 1, "code": "1A", "name": "初级A", "sort": 1 },
    { "id": 2, "code": "1B", "name": "初级B", "sort": 2 },
    { "id": 3, "code": "1C", "name": "初级C", "sort": 3 },
    ...
  ]
}
```

### 奖惩记录相关接口

#### GET /rewards
获取奖惩记录列表

**查询参数:**
- `page` - 页码（默认1）
- `pageSize` - 每页数量（默认10）
- `employeeId` - 员工ID筛选
- `type` - 类型筛选（reward/punishment）
- `startDate` - 开始日期
- `endDate` - 结束日期

**响应:**
```json
{
  "success": true,
  "data": {
    "list": [
      {
        "id": 1,
        "employeeId": 10,
        "employeeNo": "EMP010",
        "employeeName": "陈十二",
        "type": "reward",
        "reason": "年度优秀员工",
        "amount": 5000,
        "date": "2024-01-15T00:00:00.000Z"
      }
    ],
    "total": 50,
    "page": 1,
    "pageSize": 10
  }
}
```

#### POST /rewards
创建奖惩记录（仅管理员）

**请求体:**
```json
{
  "employeeId": 10,
  "type": "reward",
  "reason": "项目奖金",
  "amount": 3000,
  "date": "2024-01-15"
}
```

#### PUT /rewards/:id
更新奖惩记录（仅管理员）

#### DELETE /rewards/:id
删除奖惩记录（仅管理员）

## 数据库设计

### Department (部门表)
部门信息表

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Int | PRIMARY KEY, AUTO_INCREMENT | 部门ID |
| name | String | UNIQUE, NOT NULL | 部门名称 |
| description | String | | 部门描述 |
| createdAt | DateTime | DEFAULT NOW() | 创建时间 |
| updatedAt | DateTime | @updatedAt | 更新时间 |

### Position (岗位表)
岗位信息表

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Int | PRIMARY KEY, AUTO_INCREMENT | 岗位ID |
| name | String | UNIQUE, NOT NULL | 岗位名称 |
| level | String | | 职级（如 3B、4A） |
| description | String | | 岗位描述 |
| createdAt | DateTime | DEFAULT NOW() | 创建时间 |
| updatedAt | DateTime | @updatedAt | 更新时间 |

### Level (职级表)
职级体系表

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Int | PRIMARY KEY, AUTO_INCREMENT | 职级ID |
| code | String | UNIQUE, NOT NULL | 职级代码（1A-7C） |
| name | String | | 职级名称 |
| sort | Int | DEFAULT 0 | 排序 |
| createdAt | DateTime | DEFAULT NOW() | 创建时间 |
| updatedAt | DateTime | @updatedAt | 更新时间 |

### Reward (奖惩记录表)
奖惩记录表

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Int | PRIMARY KEY, AUTO_INCREMENT | 记录ID |
| employeeId | Int | NOT NULL | 关联员工ID |
| type | String | NOT NULL | 类型：reward 奖励 / punishment 惩罚 |
| reason | String | NOT NULL | 原因 |
| amount | Int | DEFAULT 0 | 金额（正数为奖金，负数为罚款） |
| date | DateTime | DEFAULT NOW() | 发生日期 |
| description | String | | 详细描述 |
| createdAt | DateTime | DEFAULT NOW() | 创建时间 |
| updatedAt | DateTime | @updatedAt | 更新时间 |

**枚举值:**
- type: `reward` - 奖励, `punishment` - 惩罚

### User (用户表)

### User (用户表)
用户表，存储系统用户信息用于登录认证

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Int | PRIMARY KEY, AUTO_INCREMENT | 用户ID |
| username | String | UNIQUE, NOT NULL | 用户名 |
| password | String | NOT NULL | 密码（bcrypt哈希） |
| name | String | NOT NULL | 真实姓名 |
| role | String | NOT NULL | 角色：admin/hr/manager/user |
| createdAt | DateTime | DEFAULT NOW() | 创建时间 |
| updatedAt | DateTime | @updatedAt | 更新时间 |

**枚举值 (role):**
- `admin` - 系统管理员
- `hr` - HR管理员
- `manager` - 部门主管
- `user` - 普通用户

### Employee (员工表)
员工信息表，存储员工基本资料

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Int | PRIMARY KEY, AUTO_INCREMENT | 员工ID |
| employeeNo | String | UNIQUE, NOT NULL | 工号 |
| name | String | NOT NULL | 姓名 |
| gender | String | NOT NULL | 性别：male/female/other |
| age | Int | | 年龄 |
| phone | String | | 联系电话 |
| email | String | | 邮箱 |
| department | String | | 部门（文本存储，后续关联部门表） |
| position | String | | 岗位 |
| level | String | | 职级：1A-7C |
| hireDate | DateTime | | 入职日期 |
| status | String | NOT NULL, DEFAULT 'active' | 在职状态：active/inactive |
| createdAt | DateTime | DEFAULT NOW() | 创建时间 |
| updatedAt | DateTime | @updatedAt | 更新时间 |

**枚举值:**
- gender: `male` - 男, `female` - 女, `other` - 其他
- status: `active` - 在职, `inactive` - 离职
- level: 1A-7C（职级体系）

### Prisma Schema

```prisma
datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  name      String
  role      String   // admin | hr | manager | user
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Employee {
  id          Int      @id @default(autoincrement())
  employeeNo  String   @unique
  name        String
  gender      String   // male | female | other
  age         Int?
  phone       String?
  email       String?
  department  String?
  position    String?
  level       String?  // 1A-7C
  hireDate    DateTime?
  status      String   @default("active")  // active | inactive
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Department {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Position {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  level       String   // 职级，如 3B、4A
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Level {
  id          Int      @id @default(autoincrement())
  code        String   @unique  // 1A-7C
  name        String   // 职级名称
  sort        Int      @default(0)  // 排序
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Reward {
  id          Int      @id @default(autoincrement())
  employeeId  Int
  type        String   // reward | punishment
  reason       String
  amount       Int      @default(0)
  date        DateTime @default(now())
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

