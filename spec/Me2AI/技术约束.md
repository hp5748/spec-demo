# 技术约束 - 用户管理系统

## 架构要求
- 前后端分离架构
- 后端采用微服务化设计，服务间通过 HTTP API 通信
- 前端采用单页应用（SPA）架构

## 技术栈

### 前端
- 框架：Vue 3
- 语言：TypeScript
- UI 框架：Ant Design Vue
- 构建工具：Vite
- HTTP 客户端：Axios
- 路由：Vue Router
- 状态管理：Pinia
- 其他：响应式设计，适配 PC 和移动端

### 后端
- 语言/框架：Node.js + Express.js
- 架构：微服务化
- API 风格：RESTful API
- 数据库 ORM：推荐 Prisma
- 认证：JWT
- 其他：CORS 支持，请求日志

### 数据存储
- 数据库：SQLite
- 原因：轻量级，适合开发和中小规模部署
- 注意：生产环境可根据需求迁移至 PostgreSQL/Oracle/MySQL

## 编码规范
- 前端和后端均使用 ESLint + Prettier 统一代码风格
- TypeScript 严格模式开启
- 组件命名采用 PascalCase
- 文件命名采用 camelCase
- API 接口命名采用 RESTful 风格

## 安全要求
- 用户密码必须哈希存储（bcrypt 等）
- API 接口实施认证和授权
- 敏感信息不记录到日志
- 实施 XSS 和 CSRF 防护
- 输入参数校验和过滤

## 部署要求

### 环境配置
- 开发环境：本地开发，热重载
- 生产环境：静态部署 + Node.js 服务
- 配置管理：使用环境变量（.env 文件）
- 日志管理：结构化日志输出
- 数据库初始化：支持一键初始化数据库结构

### 部署流程
项目根目录提供了 `build-deploy.bat` 打包脚本，执行后会生成 `deploy/user-management-<时间戳>/` 部署包。

#### 打包命令
```bash
build-deploy.bat
```

#### 部署包结构
```
deploy/user-management-<时间戳>/
├── backend/
│   ├── dist/              # 后端编译产物
│   ├── prisma/           # 数据库 schema 和种子数据
│   ├── package.json      # 依赖清单
│   └── .env              # 环境变量（需手动配置）
├── frontend/
│   └── dist/             # 前端静态文件
├── start.bat             # 启动脚本
└── README.md             # 部署说明
```

#### 启动方式
1. 双击 `start.bat` 启动后端服务（自动安装依赖、初始化数据库）
2. 使用 Web 服务器托管 `frontend/dist` 目录

#### 前端部署选项

**方式一：使用 npx serve（测试环境）**
```bash
cd frontend/dist
npx serve . -p 8080
```

**方式二：使用 nginx（生产环境推荐）**
```nginx
server {
    listen 80;
    server_name localhost;

    location / {
        root C:/path/to/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://localhost:3001;
    }
}
```

#### 环境变量说明
后端环境变量位于 `backend/.env`：
- `PORT=3001` - 服务端口
- `JWT_SECRET=your-secret` - JWT 密钥
- `DB_PATH=./prisma/dev.db` - 数据库路径
